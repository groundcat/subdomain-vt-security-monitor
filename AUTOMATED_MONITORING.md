# Automated Domain Security Monitoring

This system provides automated security monitoring for domains and their subdomains, perfect for SaaS operators who need to monitor domains where subdomains are assigned to untrusted users.

## üéØ Use Case

**Perfect for SaaS providers** where:
- Main domain: `yourapp.com`
- User subdomains: `user123.yourapp.com`, `company.yourapp.com`
- Need to detect malicious activity on user-controlled subdomains
- Want automated alerts when threats are detected

## üöÄ Features

- **üìä Comprehensive Analysis**: Full domain + subdomain security analysis
- **ü§ñ Fully Automated**: No user interaction required
- **üìß Email Reports**: Beautiful HTML emails with security alerts
- **üîÑ GitHub Actions**: Automated scheduling and execution
- **üìà Executive Summaries**: High-level overview for management
- **üö® Real-time Alerts**: Immediate notification of threats
- **üìù Detailed Reports**: Complete analysis logs for investigation

## üìã Setup Instructions

### 1. Local Setup

1. **Configure Domains to Monitor**
   ```bash
   # Edit suffix.txt - add your domains (one per line)
   echo "yourapp.com" >> suffix.txt
   echo "yourcompany.com" >> suffix.txt
   ```

2. **Configure Settings** (choose one method):

   **Method A: Environment Variables** (Recommended for production)
   ```bash
   export VT_API_KEY="your-virustotal-api-key"
   export SMTP_SERVER="smtp.gmail.com"
   export SMTP_USERNAME="your-email@gmail.com"
   export SMTP_PASSWORD="your-app-password"
   export EMAIL_FROM="security@yourcompany.com"
   export EMAIL_TO="admin@yourcompany.com,security@yourcompany.com"
   export COMPANY_NAME="Your Company"
   ```

   **Method B: Local Settings File** (For development only)
   ```python
   # Create settings.py (will be gitignored)
   API_KEY = 'your-virustotal-api-key'
   SMTP_SERVER = 'smtp.gmail.com'
   SMTP_USERNAME = 'your-email@gmail.com'
   SMTP_PASSWORD = 'your-app-password'
   EMAIL_FROM = 'security@yourcompany.com'
   EMAIL_TO = ['admin@yourcompany.com', 'security@yourcompany.com']
   COMPANY_NAME = 'Your Company'
   ```

3. **Run Monitoring**
   ```bash
   python suffix_report.py
   ```

### 2. GitHub Actions Setup (Automated)

1. **Add Repository Secrets**
   Go to your GitHub repo ‚Üí Settings ‚Üí Secrets ‚Üí Actions, and add:

   ```
   VT_API_KEY: your-virustotal-api-key
   SMTP_SERVER: smtp.gmail.com
   SMTP_PORT: 587
   SMTP_USERNAME: your-email@gmail.com
   SMTP_PASSWORD: your-app-password
   EMAIL_FROM: security@yourcompany.com
   EMAIL_TO: admin@yourcompany.com,security@yourcompany.com
   COMPANY_NAME: Your Company Name
   ```

2. **Customize Schedule**
   Edit `.github/workflows/domain-monitoring.yml`:
   ```yaml
   schedule:
     - cron: '0 8 * * *'  # Daily at 8 AM UTC
     # - cron: '0 */6 * * *'  # Every 6 hours
     # - cron: '0 8 * * 1'   # Weekly on Monday
   ```

3. **Enable Workflow**
   - Push to GitHub
   - Go to Actions tab ‚Üí Enable workflows
   - The monitoring will run automatically on schedule

## üìß Email Configuration

### Gmail Setup (Recommended)
1. Enable 2-Factor Authentication
2. Generate App Password: Google Account ‚Üí Security ‚Üí App passwords
3. Use app password (not your regular password) in `SMTP_PASSWORD`

### Other Email Providers
```bash
# Outlook/Hotmail
SMTP_SERVER=smtp-mail.outlook.com
SMTP_PORT=587

# Yahoo
SMTP_SERVER=smtp.mail.yahoo.com
SMTP_PORT=587

# Custom SMTP
SMTP_SERVER=mail.yourcompany.com
SMTP_PORT=587
```

## üìä Report Types

### 1. Console Output
Real-time progress and summary:
```
üîç Domain Security Monitoring System
====================================
üìã Monitoring 2 domains: yourapp.com, company.com

============================================================
ANALYZING DOMAIN: yourapp.com
============================================================
Domain Analysis: M:0, S:0, U:94, H:0, T:0
Fetching subdomains...
Found 245 subdomains on page 1, continuing to next page...
Analyzing 387 subdomains...
Subdomain Summary: Total:387, üî¥M:3, üü°S:1, üü¢H:23, ‚ö™U:360, ‚è±Ô∏èT:0

üö® SECURITY ALERT: Malicious activity detected!
```

### 2. Email Report
Beautiful HTML email with:
- **Executive Summary**: High-level statistics
- **Alert Level**: Visual indicator (üî¥ HIGH, üü° MEDIUM, ‚úÖ LOW)
- **Domain Analysis**: Per-domain breakdown
- **Threat Details**: List of malicious/suspicious subdomains
- **Attached Report**: Complete text analysis

### 3. Text Report
Detailed analysis saved to `output/automated-reports/`:
```
Domain Security Monitoring Report
Generated by: Your Company
Report Date: 2025-01-27 08:15:30 UTC

EXECUTIVE SUMMARY
=================
Total Domains Monitored: 2
Total Subdomains Analyzed: 387
Malicious Domains Found: 0
Malicious Subdomains Found: 3
Suspicious Subdomains Found: 1

üî¥ MALICIOUS SUBDOMAINS:
  - phishing.yourapp.com (M:2, S:0, Rep:-5)
  - malware.yourapp.com (M:3, S:1, Rep:-8)
```

## ‚öôÔ∏è Configuration Options

### Environment Variables
| Variable | Description | Example |
|----------|-------------|---------|
| `VT_API_KEY` | VirusTotal API key | `abc123...` |
| `SMTP_SERVER` | SMTP server hostname | `smtp.gmail.com` |
| `SMTP_PORT` | SMTP port (usually 587) | `587` |
| `SMTP_USERNAME` | SMTP username | `alerts@company.com` |
| `SMTP_PASSWORD` | SMTP password/app password | `app-password` |
| `EMAIL_FROM` | Sender email address | `security@company.com` |
| `EMAIL_TO` | Recipients (comma-separated) | `admin@company.com,ceo@company.com` |
| `EMAIL_SUBJECT` | Email subject template | `Security Alert - {date}` |
| `EMAIL_REPLY_TO` | Reply-to address | `noreply@company.com` |
| `COMPANY_NAME` | Organization name | `Your Company Inc` |
| `REPORT_TITLE` | Report title | `Domain Security Report` |

### Scheduling Options
```yaml
# GitHub Actions cron examples:
- cron: '0 8 * * *'      # Daily at 8 AM UTC
- cron: '0 */6 * * *'    # Every 6 hours
- cron: '0 8 * * 1'      # Weekly on Monday at 8 AM
- cron: '0 8 1 * *'      # Monthly on 1st at 8 AM
- cron: '0 8,20 * * *'   # Twice daily (8 AM, 8 PM)
```

## üîí Security Best Practices

1. **API Key Security**
   - Use GitHub Secrets for API keys
   - Never commit API keys to repository
   - Rotate keys regularly

2. **Email Security**
   - Use app passwords, not account passwords
   - Enable 2FA on email accounts
   - Use dedicated security email addresses

3. **Access Control**
   - Limit repository access
   - Use environment-specific secrets
   - Monitor action logs

## üö® Alert Levels

| Level | Condition | Action |
|-------|-----------|--------|
| **üî¥ HIGH** | Malicious domains/subdomains found | Immediate investigation required |
| **üü° MEDIUM** | Suspicious activity detected | Review and monitor |
| **‚úÖ LOW** | All clean | Continue monitoring |

## üõ†Ô∏è Troubleshooting

### Common Issues

1. **"Missing API key"**
   - Check `VT_API_KEY` environment variable
   - Verify VirusTotal API key is valid

2. **"Email sending failed"**
   - Verify SMTP credentials
   - Check if 2FA is enabled (use app password)
   - Confirm SMTP server settings

3. **"No domains found"**
   - Check `suffix.txt` exists and contains domains
   - Ensure domains are not commented out (#)

4. **Rate limiting (429 errors)**
   - The optimized version should avoid this
   - Consider adding delays for very large domain lists

### Debug Mode
Add debug output by modifying the script:
```python
# Add at the top of suffix_report.py
import logging
logging.basicConfig(level=logging.DEBUG)
```

## üìà Scaling for Large Operations

For organizations monitoring 100+ domains:

1. **Split Domain Lists**
   ```bash
   # Create multiple suffix files
   echo "critical-domains.com" > suffix-critical.txt
   echo "secondary-domains.com" > suffix-secondary.txt
   ```

2. **Staggered Scheduling**
   ```yaml
   # Critical domains - every 6 hours
   - cron: '0 */6 * * *'
   # Secondary domains - daily
   - cron: '0 8 * * *'
   ```

3. **Parallel Processing**
   - Run multiple GitHub Actions workflows
   - Use different API keys for higher limits

## ü§ù Integration Examples

### Slack Integration
Add to GitHub Actions:
```yaml
- name: Send Slack Alert
  if: contains(steps.scan.outputs.result, 'MALICIOUS')
  uses: 8398a7/action-slack@v3
  with:
    status: failure
    text: 'üö® Malicious domains detected! Check email for details.'
```

### PagerDuty Integration
```yaml
- name: Trigger PagerDuty
  if: contains(steps.scan.outputs.result, 'HIGH')
  run: |
    curl -X POST https://events.pagerduty.com/v2/enqueue \
      -H 'Content-Type: application/json' \
      -d '{"routing_key":"${{ secrets.PAGERDUTY_KEY }}","event_action":"trigger"}'
```

### SIEM Integration
Export reports to security tools:
```bash
# Example: Send to Splunk
curl -X POST "$SPLUNK_HEC_URL" \
  -H "Authorization: Splunk $SPLUNK_TOKEN" \
  -d @output/automated-reports/latest-report.json
```

This automated monitoring system provides enterprise-grade domain security surveillance with minimal setup and maximum visibility. Perfect for SaaS operators who need to stay ahead of subdomain-based threats! 